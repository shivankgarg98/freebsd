"Simplicity is the ultimate sophistication"
------------------------
|mac_ipacl Design Notes|
------------------------
[EDIT] point 6 added in goals 

[EDIT] NOTE: I am thinking to change the module name to mac_ifacl and compatibilty
of controlling hw_addr


Design Goals -
------------
1. Do we need to check the addresses per interface per vnet-jail or addresses per
   vnet-jail?
  
   The first one gives more flexibilty but increases complexity of policy table.
   The first is more prefered over the second since it gives ability to restrict
   the particular interface of a jail.

2. Another question which increses complexity here is- Should jails be allowed to
   create new interface(intefaces created after the policy has been loaded? and,
   if yes, then how our module will react to the new interface?

   I am not sure about this one. But the new interfaces shall not affect the host
   until and unless they are connected to the host or other jail. So, they don't
   have any effect but this issue should be dealt to prevent any design flaw/bugs.
 
   New interfaces, by default, should not have any rights to set the IP address,
   new rules(about the new interface) have to be applied by the host to provide
   those rights.

3. Another important step is to decide whether to allow all IP addresses or reject
   all IP address when the MAC module is loaded?
   
   I'm thinking to allow all address when the module is loaded and then tune it with
   a sysctl variable to disallow all. The host can then specify IP address to allow
   according to the Policy Table.

4. The "Policy Table" may take-
   a.) JID(or name of the jail) - the jail id/name for the jail for which the
       restriction are to be applied, This identifies that jail.
   b.) Network Interface - The network interface which are allowed to set the IP
       address and/or which are not?
       OR we can say, name of the interfaces that are allowed for setting their IP
   c.) IP address/list of IP address which are allowed for particular interface.
   d.) Network Prefix(A range of IP address) that is allowed to the jail.
   e.) label to allow/reject? But depend on whether we started with all IP or NO IP.
   f.) ?

5. In policy, we may check the jail by passing the credential and where the thread is
   and also if the thread's vnet and intefaces matches.

6. How to name the jail in the policy?
   
   I am thinking of using jid to name the jail in the policy. But another question
   arises is how to find that jail with that jid. Search for the function that find
   your prison with given jid. check  prison_find(int jid), this will solve this problem

7. should we also check for subnet the jail is choosing? If yes, then we also have to pass
   the prefix to the framework. 
 
Points
(To be kept in mind) -
--------------------
1. ioctl check calls should be kept generic. Although, currently we are only interested
   in VIMAGE JAILS, but in future might need to  extend the MAC module to host system,
   et cetera.
   So, the MAC calls should run for all cases, and checks related to jails and VNET 
   should be handled later in the Policy Module

3. vnet should be checked from socket or interface and not from the thread. This means
   we'd probably have to pass one of those in the policy as well.
   
   Passing the interface ifnet to the policy will be more easy/appropriate, since only
   it is available as arguement in in.c(in_aifaddr_ioctl) for our MAC checks. Alternatively
   we could have moved our check to in_control() for ipv4 case like we have in IPv6 case,
   for checking the vnet from socket.
